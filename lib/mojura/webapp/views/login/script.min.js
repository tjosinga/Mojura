var LoginView=function(t){"use strict";function e(e,n,i,a,o){t.getJSON("__api__/salt",function(u){var r=CryptoJS.MD5(e+":"+u.realm+":"+n).toString();var s=500+u.realm.length+e.length;var f=CryptoJS.PBKDF2(r,u.salt,{keySize:16,iterations:s});var d="__api__/authenticate?username="+e+"&password="+f;if(i){d+="&set_cookie=true"}t.getJSON(d,function(t){if(a!==undefined){a()}}).error(function(){if(o!==undefined){o()}})})}function n(e){t(".alert",e).remove();t("input[name=submit]",e).button("loading");LoginView.authenticate(t("input[name=username]",e).val(),t("input[name=password]",e).val(),t("input[name=set_cookie]",e).attr("checked"),function(){t(e).attr("onsubmit","return false");t("input[name=submit]",e).button("complete").addClass("btn-success disabled").attr("disabled","disabled");var n=t("input[name=redirect]",e).val();if(typeof n==="undefined"){n="/"}window.location.href=n},function(){var n=Alert.create({text:Locale.str("login","failed")});t(e).prepend(n);t("input[name=submit]",e).button("reset")})}function i(e){t.getJSON("__api__/signoff",function(t){if(e!==undefined){e()}})}function a(e){t("#submit",e).button("loading");LoginView.signOff(function(){t(e).attr("onsubmit","return false");t("#submit",e).button("complete").addClass("btn-success disabled").attr("disabled","disabled");window.location.href="/"})}return{authenticate:e,authenticateWithForm:n,signOff:i,signOffWithForm:a}}(jQuery);