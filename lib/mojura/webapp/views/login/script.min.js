var LoginView=(function(c){function a(j,h,i,g,f){c.getJSON("__api__/salt",function(n){var o=CryptoJS.MD5(j+":"+n.realm+":"+h).toString();var k=500+n.realm.length+j.length;var m=CryptoJS.PBKDF2(o,n.salt,{keySize:16,iterations:k});var l="__api__/authenticate?username="+j+"&password="+m;if(i){l+="&set_cookie=true"}c.getJSON(l,function(p){if(g!==undefined){g()}}).error(function(){if(f!==undefined){f()}})})}function b(f){c(".alert",f).remove();c("input[name=submit]",f).button("loading");LoginView.authenticate(c("input[name=username]",f).val(),c("input[name=password]",f).val(),c("input[name=set_cookie]",f).attr("checked"),function(){c(f).attr("onsubmit","return false");c("input[name=submit]",f).button("complete").addClass("btn-success disabled").attr("disabled","disabled");var g=c("input[name=redirect]",f).val();if(typeof g==="undefined"){g="/"}window.location.href=g},function(){var g=Alert.create({text:Locale.str("login","failed")});c(f).prepend(g);c("input[name=submit]",f).button("reset")})}function d(f){c.getJSON("__api__/signoff",function(g){if(f!==undefined){f()}})}function e(f){c("#submit",f).button("loading");LoginView.signOff(function(){c(f).attr("onsubmit","return false");c("#submit",f).button("complete").addClass("btn-success disabled").attr("disabled","disabled");window.location.href="/"})}return{authenticate:a,authenticateWithForm:b,signOff:d,signOffWithForm:e}})(jQuery);