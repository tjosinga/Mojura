var PostsView=function(e){"use strict";function t(e){s(e,1)}function s(t,s){var o="__api__/posts?include_replies=true";if(s>0){o+="&page="+s}e(t).append("<div class='loading'></div>");e.getJSON(o,function(s){for(var o=0;o<s.items.length;o++){s.items[o].is_post=true;s.items[o].pretty_timestamp=moment(s.items[o].timestamp).fromNow();s.items[o].reply_count=s.items[o].replies.length;s.items[o].has_replies=s.items[o].reply_count>0;s.items[o].likes_str=i(s.items[o].likes);for(var n=0;n<s.items[o].replies.length;n++){s.items[o].replies[n].is_post=false;s.items[o].replies[n].likes_str=i(s.items[o].replies[n].likes)}}s.viewid=t;s.has_more=s.pageinfo.current<s.pageinfo.pagecount;s.next_page=s.pageinfo.current+1;e.extend({},Locale.getViewsStrings(["posts"]));var l=e("#template_posts_posts").html();var p={message:e("#template_posts_message").html(),addform:e("#template_posts_add_edit").html()};var a=Mustache.to_html(l,s,p);e(".posts_load_more, .loading",t).remove();e(t).append(a)})}function i(e){var t="";for(var s in e){if(t!==""){t+=", "}t+=e[s]}if(t!==""){t='<i class="fa fa-thumbs-up"></i> '+t}return t}function o(t,s,o){var n="__api__/posts/"+s;var l=s;if(typeof o!=="undefined"){n+="/reply/"+o;l=o}n+="/likes/?";n+=t==="like"?"_method=put":"_method=delete";e.getJSON(n,function(t){e(".likes_"+l).html(i(t));e(".like_btn_"+l).toggleClass("hidden");e(".unlike_btn_"+l).toggleClass("hidden")})}function n(e,t){o("like",e,t)}function l(e,t){o("unlike",e,t)}function p(t,i,o){var n="__api__/";if(typeof o==="undefined"){n+="posts"}else{n+="posts/"+o+"/replies"}if(i){n+="?_method=post"}e.post(n,"message="+encodeURIComponent(t),function(t){e(".posts").html("<div class='loading'></div>");s(".posts",0)})}return{init:t,load:s,like:n,unlike:l,post:p}}(jQuery);