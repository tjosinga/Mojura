var PostsView=(function(f){function g(i){e(i,1)}function e(k,j){var i="__api__/posts?include_replies=true";if(j>0){i+="&page="+j}f(k).append("<div class='loading'></div>");f.getJSON(i,function(q){for(var o=0;o<q.items.length;o++){q.items[o].is_post=true;q.items[o].pretty_timestamp=moment(q.items[o].timestamp).fromNow();q.items[o].reply_count=q.items[o].replies.length;q.items[o].has_replies=(q.items[o].reply_count>0);q.items[o].likes_str=h(q.items[o].likes);for(var l=0;l<q.items[o].replies.length;l++){q.items[o].replies[l].is_post=false;q.items[o].replies[l].likes_str=h(q.items[o].replies[l].likes)}}q.viewid=k;q.has_more=(q.pageinfo.current<q.pageinfo.pagecount);q.next_page=q.pageinfo.current+1;f.extend({},Locale.getViewsStrings(["posts"]));var p=f("#template_posts_posts").html();var n={message:f("#template_posts_message").html(),addform:f("#template_posts_add_edit").html()};var m=Mustache.to_html(p,q,n);f(".posts_load_more, .loading",k).remove();f(k).append(m)})}function h(j){var i="";for(var k in j){if(i!==""){i+=", "}i+=j[k]}if(i!==""){i='<i class="fa fa-thumbs-up"></i> '+i}return i}function c(j,m,k){var i="__api__/posts/"+m;var l=m;if(typeof k!=="undefined"){i+="/reply/"+k;l=k}i+="/likes/?";i+=(j==="like")?"_method=put":"_method=delete";f.getJSON(i,function(n){f(".likes_"+l).html(h(n));f(".like_btn_"+l).toggleClass("hidden");f(".unlike_btn_"+l).toggleClass("hidden")})}function d(j,i){c("like",j,i)}function a(j,i){c("unlike",j,i)}function b(k,i,l){var j="__api__/";if(typeof l==="undefined"){j+="posts"}else{j+="posts/"+l+"/replies"}if(i){j+="?_method=post"}f.post(j,"message="+encodeURIComponent(k),function(m){f(".posts").html("<div class='loading'></div>");e(".posts",0)})}return{init:g,load:e,like:d,unlike:a,post:b}})(jQuery);