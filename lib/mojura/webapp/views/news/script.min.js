var NewsView=(function(e){e(document).ready(function(){Locale.ensureLoaded("system");Locale.ensureLoaded("news")});function d(){a("new")}function a(f){Modal.create({id:"newsAddEditModal",modal_large:true,title:Locale.str("news","edit"),oncreated:function(g,i){e("#"+g).modal("show");var h="__api__/news/"+f+"?include_settings=news.categories";e.getJSON(h,function(p,q,j){var o=e("#template-news-addedit").html();p=e.extend({},p,Locale.getViewsStrings(["system","news"]));p.method=(f==="new")?"post":"put";p.newsid=f;var k=p.settings.news.categories;if((typeof k!=="null")||((typeof k!=="undefined"))){p.has_categories=true;if(typeof k==="string"){p.categories=k.split(",")}else{p.categories=k}for(var n in p.categories){p.categories[n]=p.categories[n].replace(/(^\s+|\s+$)/,"")}}p.urid=UIDGenerator.get();var m={"rights-controls":e("#template-rights-controls").html(),"locales-selection":e("#template-locales-selection").html()};p.simple_rights_visible=((p.rights.rights&4)>0);p.supported_locales=j.getResponseHeader("Mojura-Supported-Languages").split(", ");p.is_multilingual=(p.supported_locales.length>1);var l=Mustache.render(o,p,m);e(".modal-body","#"+g).html(l);i()});return true},onsubmitted:function(g,h){location.reload()}})}function b(f){Modal.create({id:"newsDeleteModal",btn_class:"btn-danger",btn_action:Locale.str("system","delete"),title:Locale.str("news","delete"),oncreated:function(g){e("#"+g).modal("show");var i=e("#template-news-delete").html();var j=Locale.getViewsStrings(["system","news"]);j.newsid=f;j.urid=UIDGenerator.get();var h=Mustache.render(i,j);e(".modal-body","#"+g).html(h)},onsubmitted:function(g,h){c()}})}function c(){document.location=e("base").attr("href")+"news"}return{showAdd:d,showEdit:a,showDelete:b,gotoList:c}})(jQuery);