var GroupsView=(function(e){var i;var g;function c(){a("new")}function a(l){var k=(l==="new");var m=k?"add_group":"edit_group";Modal.create({title:Locale.str("groups",m),oncreated:function(n,o){e.getJSON("__api__/groups/"+l,function(q){var r=e("#template-groups-add-edit").html();q.method=k?"post":"put";q.urid=UIDGenerator.get();var p=Mustache.render(r,q);e(".modal-body","#"+n).html(p);o()});return true}})}function d(k,l){Modal.create({title:Locale.str("groups","show_members"),modal_large:true,btn_action:Locale.str("system","close"),btn_cancel:false,save_form:false,oncreated:function(m){i=m;g=l;j(k)}})}function h(n,m){var l=e(m).closest(".input-group").find("input").attr("data-id");if(typeof l==="undefined"){return}e(m).find("i").removeClass("fa-plus").addClass("fa-spinner fa-spin");var k="__api__/users/"+l+"/groups?groupid="+n+"&_method=post";e.getJSON(k,function(o){j(n)})}function j(k){e.getJSON("__api__/groups/"+k+"/members",function(o){var l=i;var p=e("#template-groups-members").html();var n={avatars:e("#template-users-avatars").html(),avatar_partial:e("#template-avatar-partial").html()};o.groupid=k;o.has_avatar_partial=true;o.may_update=g;o.urid=UIDGenerator.get();o.raw=JSON.stringify(o);o.users_page_url="users";o.classes="col-xs-4 col-sm-3";var m=Mustache.render(p,o,n);e(".modal-body","#"+l).html(m);e(".remove-member-icon","#"+l+" .avatar").click(function(r){e(this).next(".remove-member-bar").mouseleave(function(){e(this).addClass("hidden")}).click(function(u){var t=e(this).attr("data-userid");var s="__api__/users/"+t+"/group/"+k+"?_method=delete";var v=e(this);e(".inactive",v).addClass("hidden");e(".active",v).removeClass("hidden");e.getJSON(s,function(){v.parent(".thumbnail").parent().remove()}).error(function(){e(".active",this).addClass("hidden");e(".inactive",this).removeClass("hidden")});return false}).removeClass("hidden");return false});var q=function(r){e(r).closest(".input-group").find(".btn-success").toggleClass("disabled",e(r).attr("data-id")==="")};AutoComplete.prepare("#"+l+" .add-member input",{category:"users",onselected:q})})}function b(k){Modal.create({title:Locale.str("groups","edit_rights"),oncreated:function(l,m){}})}function f(k){}return{addGroup:c,editGroup:a,showMembers:d,addMember:h,editRights:b,deleteGroup:f}})(jQuery);