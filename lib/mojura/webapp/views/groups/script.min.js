var GroupsView=function(e){"use strict";var t;var a;function r(){s("new")}function s(t){var a=t==="new";var r=a?"add_group":"edit_group";Modal.create({title:Locale.str("groups",r),oncreated:function(r,s){e.getJSON("__api__/groups/"+t,function(t){var n=e("#template-groups-add-edit").html();t.method=a?"post":"put";t.urid=UIDGenerator.get();var o=Mustache.render(n,t);e(".modal-body","#"+r).html(o);s()});return true}})}function n(e,r){Modal.create({title:Locale.str("groups","show_members"),modal_large:true,btn_action:Locale.str("system","close"),btn_cancel:false,save_form:false,oncreated:function(s){t=s;a=r;i(e)}})}function o(t,a){var r=e(a).closest(".input-group").find("input").attr("data-id");if(typeof r==="undefined"){return}e(a).find("i").removeClass("fa-plus").addClass("fa-spinner fa-spin");var s="__api__/users/"+r+"/groups?groupid="+t+"&_method=post";e.getJSON(s,function(e){i(t)})}function i(r){e.getJSON("__api__/groups/"+r+"/members",function(s){var n=t;var o=e("#template-groups-members").html();var i={avatars:e("#template-users-avatars").html(),avatar_partial:e("#template-avatar-partial").html()};s.groupid=r;s.has_avatar_partial=true;s.may_update=a;s.urid=UIDGenerator.get();s.raw=JSON.stringify(s);s.users_page_url="users";s.classes="col-xs-4 col-sm-3";var u=Mustache.render(o,s,i);e(".modal-body","#"+n).html(u);e(".remove-member-icon","#"+n+" .avatar").click(function(t){e(this).next(".remove-member-bar").mouseleave(function(){e(this).addClass("hidden")}).click(function(t){var a=e(this).attr("data-userid");var s="__api__/users/"+a+"/group/"+r+"?_method=delete";var n=e(this);e(".inactive",n).addClass("hidden");e(".active",n).removeClass("hidden");e.getJSON(s,function(){n.parent(".thumbnail").parent().remove()}).error(function(){e(".active",this).addClass("hidden");e(".inactive",this).removeClass("hidden")});return false}).removeClass("hidden");return false});var d=function(t){e(t).closest(".input-group").find(".btn-success").toggleClass("disabled",e(t).attr("data-id")==="")};AutoComplete.prepare("#"+n+" .add-member input",{category:"users",onselected:d})})}function u(e){Modal.create({title:Locale.str("groups","edit_rights"),oncreated:function(e,t){}})}function d(e){}return{addGroup:r,editGroup:s,showMembers:n,addMember:o,editRights:u,deleteGroup:d}}(jQuery);