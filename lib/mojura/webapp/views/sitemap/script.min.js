var SitemapView=function(e){"use strict";var a={};function r(r){a[r]=e("#"+r);return this}function t(r,t){var i={handle:"span.fa-reorder",nested:true,onStartDrag:function(){a[r].addClass("select-none")},onDrop:function(e,a,t,i){o(r,e,t)}};a[r].sortable(i);console.log("initialize");e(".collapse-handle").click(function(){e(this).toggleClass("fa-caret-down").toggleClass("fa-caret-right");e(this).parent().parent().children("ul").toggleClass("hide")});l(r);if(typeof t!=="undefined"){var n=e("li[data-id="+t+"]",a[r]);n.children(".list-item").addClass("current-page");n.parents(".sitemap").removeClass("hide")}return this}function i(e){delete a[e]}function n(e){return e.parent().attr("data-parentid")}function d(e){var a=parseInt(e.prev().attr("data-orderid"),10);if(isNaN(a)){a=0}if(a<parseInt(e.attr("data-orderid"),10)){a+=1}return a}function s(a){if(typeof a!=="undefined"){for(var r in a){var t=a[r];e("li[data-id="+t.id+"]").attr("data-orderid",t.orderid).find(".orderid").html(t.orderid);if(typeof t.children!=="undefined"){s(t.children)}}}}function l(r){e("span.collapse-handle",a[r]).each(function(a){var r=e(this).parent().parent().children("ul");var t=r.children("li").size()>0;e(this).toggleClass("hide",!t);var i=true;if(!t){r.children("ul").removeClass("hide")}else{i=!r.hasClass("hide")}e(this).toggleClass("fa-caret-down",i).toggleClass("fa-caret-right",!i)})}function o(r,t,i){i(t);var o=n(t);var f=d(t);var c=t.attr("data-id");t.attr("data-orderid",f).children("ul").attr("data-parentid",o);t.addClass("saving");t.children("div").children(".fa-reorder").removeClass("fa-reorder").addClass("fa-refresh fa-spin");var u="__api__/pages/"+c;var h={};h._method="put";h.orderid=f;h.parentid=o;e.post(u,h,function(a,r){e.getJSON("__api__/pages?use_locale=false",function(e){s(e);l(t);t.removeClass("saving");t.find(".fa-refresh").removeClass("fa-refresh fa-spin").addClass("fa-reorder")})},"json");a[r].removeClass("select-none")}return{register:r,initialize:t,unregister:i}}(jQuery);