var PollsView=(function(c,e){var i={};function g(m,l){var k="__api__/polls/"+m+"/votes?_method=post&index="+l+"&include_votes=true";c(".poll-"+m+" .data-container").html("<div class='loading'></div>");c.getJSON(k,function(n){i[m]=n;b(m)})}function b(k){j(k,function(o){for(var m=0;m<o.options.length;m++){o.options[m].votes.rounded_percentage=Math.round(o.options[m].votes.percentage);o.options[m].votes.percentage=Math.round(o.options[m].votes.percentage*10)/10}o.urid=UIDGenerator.get();var n=c("#template-polls-results").html();var l=e.render(n,o);c(".poll-"+k+" .data-container").html(l)})}function j(l,k){if(typeof i[l]!=="undefined"){k(i[l])}else{c.getJSON("__api__/polls/"+l+"?include_votes=true",function(m){i[l]=m;k(m)})}}function d(){h("new")}function f(k){h(k)}function h(m){var k=(typeof m==="undefined");var l=k?"action_add":"action_edit";Modal.create({id:"pollsAddEditModal",modal_large:true,title:Locale.str("polls",l),oncreated:function(n,p){c("#"+n).modal("show");var o="__api__/polls/"+m;c.getJSON(o,function(s){var r=c("#template-polls-addedit").html();s.method=k?"put":"post";s.pollid=m;s.newline="\n";s.urid=UIDGenerator.get();s=c.merge(s,Locale.getViewsStrings(["system","polls"]));var q=e.render(r,s);c(".modal-body","#"+n).html(q);return true})},onsubmitted:function(n,o){location.reload()}})}function a(k){Modal.create({id:"pollsDeleteModal",btn_class:"btn-danger",btn_action:Locale.str("system","delete"),title:Locale.str("polls","action_delete"),oncreated:function(l){c("#"+l).modal("show");var n=c("#template-polls-delete").html();var o=Locale.getViewsStrings(["system","polls"]);o.pollid=k;o.urid=UIDGenerator.get();var m=e.render(n,o);c(".modal-body","#"+l).html(m)},onsubmitted:function(l,m){location.reload()}})}return{vote:g,showResults:b,showAdd:d,showEdit:f,showDelete:a}})(jQuery,Mustache);