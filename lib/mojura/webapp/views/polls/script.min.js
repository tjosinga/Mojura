var PollsView=function(e,t){"use strict";var o={};function n(t,n){var a="__api__/polls/"+t+"/votes?_method=post&index="+n+"&include_votes=true";e(".poll-"+t+" .data-container").html("<div class='loading'></div>");e.getJSON(a,function(e){o[t]=e;l(t)})}function l(o){a(o,function(n){for(var l=0;l<n.options.length;l++){n.options[l].votes.rounded_percentage=Math.round(n.options[l].votes.percentage);n.options[l].votes.percentage=Math.round(n.options[l].votes.percentage*10)/10}n.urid=UIDGenerator.get();var a=e("#template-polls-results").html();var r=t.render(a,n);e(".poll-"+o+" .data-container").html(r)})}function a(t,n){if(typeof o[t]!=="undefined"){n(o[t])}else{e.getJSON("__api__/polls/"+t+"?include_votes=true",function(e){o[t]=e;n(e)})}}function r(){d("new")}function i(e){d(e)}function d(o){var n=typeof o==="undefined";var l=n?"action_add":"action_edit";Modal.create({id:"pollsAddEditModal",modal_large:true,title:Locale.str("polls",l),oncreated:function(l,a){e("#"+l).modal("show");var r="__api__/polls/"+o;e.getJSON(r,function(a){var r=e("#template-polls-addedit").html();a.method=n?"put":"post";a.pollid=o;a.newline="\n";a.urid=UIDGenerator.get();a=e.merge(a,Locale.getViewsStrings(["system","polls"]));var i=t.render(r,a);e(".modal-body","#"+l).html(i);return true})},onsubmitted:function(e,t){location.reload()}})}function s(o){Modal.create({id:"pollsDeleteModal",btn_class:"btn-danger",btn_action:Locale.str("system","delete"),title:Locale.str("polls","action_delete"),oncreated:function(n){e("#"+n).modal("show");var l=e("#template-polls-delete").html();var a=Locale.getViewsStrings(["system","polls"]);a.pollid=o;a.urid=UIDGenerator.get();var r=t.render(l,a);e(".modal-body","#"+n).html(r)},onsubmitted:function(e,t){location.reload()}})}return{vote:n,showResults:l,showAdd:r,showEdit:i,showDelete:s}}(jQuery,Mustache);