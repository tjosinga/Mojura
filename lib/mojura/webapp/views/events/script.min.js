var EventsView=function(t,e){"use strict";function n(){}function r(t){t=t.toLowerCase();if(t==="year"){return{section:"YYYY",title:"YYYY"}}else if(t==="month"){return{section:"YYYY-MM",title:"MMMM YYYY"}}else if(t==="week"){return{section:"YYYY-WW",title:"["+Locale.str("system","week")+"] W, YYYY"}}else{return{section:"YYYY-MM-DD",title:"LL"}}}function i(n){var i="__api__/events/";t.getJSON(i,function(i){var o="week";var s=t("#template-events").html();i.sections=a(i.items,r(o));i.show_date=o!=="days";i.items=null;i.urid=UIDGenerator.get();var c=e.render(s,i);t(n).html(c);t(".pretty-moment",n).each(function(){var e=t(this).attr("data-type");var n=t(this).text();if(e==="locale"){var r=t(this).attr("data-format");n=moment(n).format(r)}t(this).text(n)})})}function a(e,n){var r={};t(e).each(function(t){var i=e[t];var a=moment(i.start);var o=a.format(n.section);if(typeof r[o]==="undefined"){r[o]={title:a.format(n.title),events:[]}}r[o].events.push(i)});var i=[];t.each(r,function(t,e){i.push(e)});return i}function o(t){c(t,"post","new")}function s(t,e){c(t,"put",e)}function c(n,r,a){var o=r==="post";var s=o?"action_add":"action_edit";Modal.create({id:"eventsAddEditModal",title:Locale.str("events",s),oncreated:function(n,i){t("#"+n).modal("show");var o="__api__/events/"+a;t.getJSON(o,function(o){var s=t("#template-events-addedit").html();o=t.merge(o,Locale.getViewsStrings(["system","events"]));o.method=r;o.eventId=a;o.urid=UIDGenerator.get();o.simple_rights_visible=(o.rights.rights&4)>0;var c={"rights-controls":t("#template-rights-controls").html()};var l=e.render(s,o,c);t(".modal-body","#"+n).html(l);i()});return true},onsubmitted:function(t,e){location.reload();i(n)}})}function l(){}return{init:n,loadEvents:i,addEvent:o,editEvent:s,deleteEvent:l}}(jQuery,Mustache);