var EventsView=(function(f,g){function j(){}function i(k){k=k.toLowerCase();if(k==="year"){return{section:"YYYY",title:"YYYY"}}else{if(k==="month"){return{section:"YYYY-MM",title:"MMMM YYYY"}}else{if(k==="week"){return{section:"YYYY-WW",title:"["+Locale.str("system","week")+"] W, YYYY"}}else{return{section:"YYYY-MM-DD",title:"LL"}}}}}function b(l){var k="__api__/events/";f.getJSON(k,function(p){var o="week";var n=f("#template-events").html();p.sections=e(p.items,i(o));p.show_date=(o!=="days");p.items=null;p.urid=UIDGenerator.get();var m=g.render(n,p);f(l).html(m);f(".pretty-moment",l).each(function(){var r=f(this).attr("data-type");var q=f(this).text();if(r==="locale"){var s=f(this).attr("data-format");q=moment(q).format(s)}f(this).text(q)})})}function e(m,l){var n={};f(m).each(function(o){var q=m[o];var p=moment(q.start);var r=p.format(l.section);if(typeof n[r]==="undefined"){n[r]={title:p.format(l.title),events:[]}}n[r].events.push(q)});var k=[];f.each(n,function(o,p){k.push(p)});return k}function d(k){a(k,"post","new")}function c(l,k){a(l,"put",k)}function a(n,o,l){var k=(o==="post");var m=k?"action_add":"action_edit";Modal.create({id:"eventsAddEditModal",title:Locale.str("events",m),oncreated:function(p,r){f("#"+p).modal("show");var q="__api__/events/"+l;f.getJSON(q,function(v){var u=f("#template-events-addedit").html();v=f.merge(v,Locale.getViewsStrings(["system","events"]));v.method=o;v.eventId=l;v.urid=UIDGenerator.get();v.simple_rights_visible=((v.rights.rights&4)>0);var t={"rights-controls":f("#template-rights-controls").html()};var s=g.render(u,v,t);f(".modal-body","#"+p).html(s);r()});return true},onsubmitted:function(p,q){location.reload();b(n)}})}function h(){}return{init:j,loadEvents:b,addEvent:d,editEvent:c,deleteEvent:h}})(jQuery,Mustache);