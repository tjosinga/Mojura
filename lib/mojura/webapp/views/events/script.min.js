var EventsView=(function($,Mustache){function init(){}function getSectionMasks(sectionType){sectionType=sectionType.toLowerCase();if(sectionType==="year"){return{section:"YYYY",title:"YYYY"}}else{if(sectionType==="month"){return{section:"YYYY-MM",title:"MMMM YYYY"}}else{if(sectionType==="week"){return{section:"YYYY-WW",title:"["+Locale.str("system","week")+"] W, YYYY"}}else{return{section:"YYYY-MM-DD",title:"LL"}}}}}function loadEvents(eventsId){var url="__api__/events/";$.getJSON(url,function(data){var sectionType="week";var template=$("#template-events").html();data.sections=dataItemsToSections(data.items,getSectionMasks(sectionType));data.show_date=(sectionType!=="days");data.items=null;var html=Mustache.render(template,data);$(eventsId).html(html);$(".pretty-moment",eventsId).each(function(){var type=$(this).attr("data-type");var dateStr=$(this).text();if(type==="locale"){var format=$(this).attr("data-format");dateStr=moment(dateStr).format(format)}$(this).text(dateStr)})})}function dataItemsToSections(items,masks){var sections={};$(items).each(function(index){var event=items[index];var mDate=moment(event.start);var section=mDate.format(masks.section);if(typeof sections[section]==="undefined"){sections[section]={title:mDate.format(masks.title),events:[]}}sections[section].events.push(event)});var result=[];$.each(sections,function(index,sectionEvents){result.push(sectionEvents)});return result}return{init:init,loadEvents:loadEvents}})(jQuery,Mustache);