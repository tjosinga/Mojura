var AdvancedObjectRights=function(e){"use strict";var t;function i(i,n,o,s){var l=s.parentModalId;Modal.create({title:Locale.str("system","advanced_object_rights"),oncreated:function(r,d){t=r;a(i,n,o);if(typeof l!=="undefined"){e("#"+l).removeClass("fade").one("hidden.bs.modal",function(){e("#"+t).removeClass("fade").one("hidden.bs.modal",function(){e("#"+l).one("shown.bs.modal",function(){e(this).addClass("fade")}).modal("show")}).modal("show")}).modal("hide")}else{d()}},onaction:function(){if(typeof s.onsave!=="undefined"){s.onsave(r(),d("users"),d("groups"))}e("#"+t).modal("hide")}})}function a(i,a,r){var d=e("#template-advanced-object-rights").html();var s=Locale.getViewStrings("system");s.categories=[{name:Locale.str("system","guests"),bits:[4,3,2,1]},{name:Locale.str("system","users"),bits:[8,7,6,5]},{name:Locale.str("system","groupmembers"),bits:[12,11,10,9]},{name:Locale.str("system","owners"),bits:[16,15,14,13]}];var l=Mustache.render(d,s);e(".modal-body","#"+t).html(l);n(i);o("users",a);o("groups",r);var c=function(t){e(t).closest(".input-group").find(".btn-success").toggleClass("disabled",e(t).attr("data-id")==="")};AutoComplete.prepare("#"+t+" .add-users input",{category:"users",onselected:c});AutoComplete.prepare("#"+t+" .add-groups input",{category:"groups",onselected:c})}function n(i){e(".advanced-rights-checkbox","#"+t).each(function(){var t=parseInt(e(this).attr("data-bit"),10);var a=1<<t-1;var n=i&a;e(this).prop("checked",i&a)})}function r(){var i=0;e(".advanced-rights-checkbox:checked","#"+t).each(function(){var t=parseInt(e(this).attr("data-bit"),10);i+=1<<t-1});return i}function o(i,a){if(a.length>0){e(".advanced-rights-"+i+"-list","#"+t).html("<div class='loading'></div>");var n="__api__/"+i+"?filter=id:("+a.join(encodeURIComponent("|"))+")";e.getJSON(n,function(a){var n=e("#template-advanced-object-rights-"+i).html();var r={};r[i]=a.items;var o=Mustache.render(n,r);e(".advanced-rights-"+i+"-list","#"+t).html(o);e(".advanced-rights-"+i+"-alert","#"+t).toggleClass("hidden",a.items.length!==0)})}else{e(".advanced-rights-"+i+"-alert","#"+t).removeClass("hidden")}}function d(i){var a=[];e(".advanced-rights-"+i+"-list .listitem","#"+t).each(function(){a.push(e(this).attr("data-id"))});return a}function s(i,a){e(i).parent().parent().remove();var n=e(".advanced-rights-"+a+"-list .listitem","#"+t).size()>0;e(".advanced-rights-"+a+"-alert","#"+t).toggleClass("hidden",n)}function l(i){e("#"+t+" .add-"+i).removeClass("hidden").find(".btn-success").addClass("disabled")}function c(i){var a=e(".add-"+i+" input","#"+t);var n=a.attr("data-id");var r=a.val();var o={};if(i==="users"){o={users:{id:n,fullname:r}}}else{o={groups:{id:n,name:r}}}var d=e("#template-advanced-object-rights-"+i).html();var s=Mustache.render(d,o);e(".advanced-rights-"+i+"-list","#"+t).append(s);e(".advanced-rights-"+i+"-alert").addClass("hidden");e("#"+t+" .add-"+i).addClass("hidden")}function u(i){e("#"+t+" .add-"+i).addClass("hidden")}return{show:i,removeId:s,showAdd:l,confirmAdd:c,cancelAdd:u}}(jQuery);var Alert=function(){"use strict";var e;function t(t){t.type=typeof t.type!=="undefined"?t.type:"danger";t.dismissable=typeof t.dismissable!=="undefined"?t.dismissable:true;if(typeof t.title==="undefined"){t.title=Locale.str("system","alert_title_"+t.type)}if(typeof e==="undefined"){e=$("#template-alert").html()}return Mustache.render(e,t)}return{create:t}}();var AutoComplete=function(e){"use strict";var t={};function i(i,r){var o=r.dataset||r.category||UIDGenerator.get();t[o]={input:i,options:a(r)};var d=e(i);e(i).after("<ul class='autocomplete-dropdown dropdown-menu hidden' data-toggle='dropdown'></ul>");t[o].$input=d;t[o].options=a(r);t[o].$dropdown=d.next(".autocomplete-dropdown");r=t[o].options;var s=t[o].$dropdown;var l="";d.blur(function(){clearTimeout(r.timer);var i=t[o].$dropdown.children("li");if(i.size()===1&&i.first().text()===e(this).val()){i.first().click();return}setTimeout(function(){if(typeof d.attr("data-id")==="undefined"||d.attr("data-id")===""){d.val("")}s.addClass("hidden")},500)}).keyup(function(e){if(e.keyCode===27){s.addClass("hidden")}else if(e.keyCode===38){s.children("li.active").prev("li").addClass("active").next("li").removeClass("active")}else if(e.keyCode===40){var t=s.children("li.active");if(t.size()===0){s.children("li").first().addClass("active")}else{t.next().addClass("active").prev().removeClass("active")}}else if(e.keyCode===13){s.children("li.active").click()}}).keypress(function(){if(r.timer===null||typeof r.timer==="undefined"){clearTimeout(r.timer)}r.timer=setTimeout(function(){n(o,d.val())},r.delay)})}function a(e){e=e||{};e.url=e.url||"__api__/search?keywords=%KEYWORDS%&pagesize=%LENGTH%&category=%CATEGORY%";e.item_template=e.item_template||"<li data-id='{{id}}'>{{title}}</li>";e.timer=null;e.length=e.length||8;e.category=e.category||"";e.forceSelection=true;e.delay=1e3;return e}function n(i,a){var n=t[i].$dropdown;var r=t[i].$input;var o=t[i].options;if(a===""){n.addClass("hidden");return}var d=o.url.replace(/%KEYWORDS%/,a).replace(/%LENGTH%/,o.length).replace(/%CATEGORY%/,o.category);e.getJSON(d,function(t){var i="";var a="";for(var d in t){a+=Mustache.render(o.item_template,t[d])}n.toggleClass("hidden",a==="");n.html(a).children("li").click(function(){clearTimeout(o.timer);r.attr("data-id",e(this).attr("data-id")).val(e(this).text());n.addClass("hidden");if(typeof o.onselected!=="undefined"){o.onselected(r[0])}})})}return{prepare:i}}(jQuery);var KeyValueParser=function(){"use strict";var e;function t(t,i){i=typeof i!=="undefined"?i:{};i.sep_char=typeof i.sep_char!=="undefined"?i.sep_char:"=";i.trim_values=typeof i.trim_values!=="undefined"?i.trim_values:true;i.comment_char=typeof i.comment_char!=="undefined"?i.comment_char:"#";var a={};var n=t.match(/[^\r\n]+/g);for(var r in n){if(n.hasOwnProperty(r)){var o=n[r].replace(/^\s+|\s+$/g);if(o!==""&&o[0]!==i.comment_char){var d=o.split(i.sep_char,2);var s=d[0].toString().replace(/^\s+|\s+$/g,"");var l=d[1];if(i.trim_values){l=l.replace(/^\s+|\s+$/g,"")}a[s]=l}}}e=a;return a}function i(){var t="";if(typeof e!=="undefined"){for(var i in e){if(e.hasOwnProperty(i)){t+=i+": "+e[i]+"\n"}}}return t}return{parse:t,toString:i}}();var LightBox=function(e){"use strict";var t={};var i={};var a;var n;var r;var o;var d;function s(e,a,n){t[e]=t[e]||[];i[e]=i[e]||0;n=n||{};n.url=a;if(a.match(/(http:|https:)?\/\/(www\.)?(youtube.com|youtu.be)\/(watch)?(\?v=)?(\S+)?/)){n.type="iframe";n.url=n.url.replace("watch?v=","v/")}else if(a.match(/vimeo/)){var r=n.url.match(/(https?:\/\/)?(www.)?(player.)?vimeo.com\/([a-z]*\/)*([0-9]{6,11})[?]?.*/);var o=r.pop();n.type="iframe";n.url="https://player.vimeo.com/video/"+o}else if(typeof n.type==="undefined"){n.type="image"}n.name="";n.description="";t[e].push(n)}function l(s,l){if(typeof t[s]==="undefined"){return}a=s;d=d||e("#template-lightbox").html();if(typeof l==="number"){i[a]=l}else{i[a]=m(l)}var u=Mustache.to_html(d,{group:a});e("body").append(u);n=e("#lightbox-"+a);o=e(".lightbox-content",n);r=e(".lightbox-dialog",n);var p=function(e){if(e.keyCode===27){n.modal("hide")}else if(e.keyCode===37){f()}else if(e.keyCode===39){v()}};n.on("shown.bs.modal",function(){e(document).on("keyup",p)});n.on("hide.bs.modal",function(){e(document).off("keyup",p)});n.on("hidden.bs.modal",function(){n.remove()});e(".lightbox-left, .lightbox-right",n).toggleClass("hidden",t[a].length<2);c();n.modal("show")}function c(){var r=i[a]||0;var o=t[a][r];var d=e(".aspect-ratio",n);e(".lightbox-content > *, .lightbox-content .aspect-ratio > *",n).addClass("hidden");if(o.type==="image"){var s=e(".lightbox-image",n);if(s.src!==o.url){s.attr("src",o.url)}s.removeClass("hidden");d.addClass("hidden")}else{if(o.type==="video"){var l=e(".lightbox-video",n);e("source",l).attr("src",o.url);l.removeClass("hidden")}else if(o.type==="iframe"){var c=e(".lightbox-iframe",n);if(c.attr("src")!==o.url){c.attr("src",o.url).load(function(){e(this).removeClass("hidden")})}else{c.removeClass("hidden")}}d.removeClass("hidden")}}function u(e){var n=t[a].length;i[a]=(i[a]+n+e)%n;c(a)}function f(){u(-1)}function v(){u(1)}function m(e){for(var i in t[a]){if(typeof t[a][i]!=="undefined"){var n=t[a][i];if(n.url===e){return Number(i)}}}return 0}function p(e){t[e]=[];i[e]=0}return{add:s,show:l,previous:f,next:v,clear:p}}(jQuery);var Locale=function(e){"use strict";var t="";var i={};function a(e){t=e}function n(e,t){if(typeof i[e]==="undefined"){r(e,t)}else if(typeof t!=="undefined"&&typeof t.loaded!=="undefined"){t.loaded()}}function r(a,n){if(t===""){window.alert('You should initialize the locale object with Locale.init("en"), where "en" is the used locale.');return}if(typeof a==="undefined"){throw"The view needs to be set calling Locale.load(view, [options = {}])"}var r=a==="system"?"mojura/views/strings."+t+".kv":"views/"+a+"/strings."+t+".kv";e.ajax({url:r,error:function(){if(typeof n!=="undefined"&&typeof n.loaded!=="undefined"&&n.breakOnFail!==true){n.loaded()}},fail:function(){window.console.log("Error fetching "+r);if(typeof n.error!=="undefined"){n.error()}if(typeof n!=="undefined"&&typeof n.loaded!=="undefined"&&n.breakOnFail!==true){n.loaded()}},success:function(e){try{i[a]=KeyValueParser.parse(e);if(typeof n!=="undefined"&&typeof n.loaded!=="undefined"){n.loaded()}}catch(t){window.console.log("Error on parsing "+r+": "+t.message);i[a]={};if(typeof n.error!=="undefined"){n.error()}}}})}function o(e,t,a){if(typeof i[e]==="undefined"){i[e]={}}i[e][t]=a}function d(e,t){if(typeof i[e]!=="undefined"&&typeof i[e][t]!=="undefined"){return i[e][t]}else{return"__"+e+"_"+t+"__"}}function s(){var t=[];e.each(i,function(e,i){t.push(e)});return t}function l(t,a,n){a=typeof a==="undefined"||a===true;var r=typeof n!=="undefined";var o={};if(typeof i[t]!=="undefined"){e.each(i[t],function(e,i){if(!r||e.indexOf(n)===0){if(a){o["locale_str_"+t+"_"+e]=i}else{o[e]=i}}})}return o}function c(t,i,a){i=typeof i==="undefined"||i===true;var n={};if(typeof t==="undefined"){return n}e.each(t,function(t,r){var o=l(r,i,a);if(i){n=e.extend({},n,o)}else{n[r]=o}});return n}return{init:a,ensureLoaded:n,loadedViews:s,add:o,str:d,getViewStrings:l,getViewsStrings:c}}(jQuery);var Modal=function(e){"use strict";var t=1;var i;var a;var n;var r;function o(n){a=n;Locale.ensureLoaded("system",{loaded:function(){var n=e("#template-modal").html();if(typeof a.id==="undefined"){a.id="modal_"+t++}a.btn_action=typeof a.btn_action!=="undefined"?a.btn_action:Locale.str("system","save");a.btn_class=typeof a.btn_class!=="undefined"?a.btn_class:"btn-primary";a.btn_cancel=typeof a.btn_cancel!=="undefined"?a.btn_cancel:Locale.str("system","cancel");a.modal_large=a.modal_large===true;a.fade=a.fade!==false;a.urid=UIDGenerator.get();a.save_form=a.save_form!==false;var r=Mustache.render(n,a);e("body").append(r);i=e("#"+a.id);i.on("hidden.bs.modal",function(e){if(i.hasClass("fade")){i.remove()}});if(!a.oncreated||!a.oncreated(a.id,d)){d()}}})}function d(){r=e("."+a.btn_class,i);n=e("form",i);var t=a.save_form&&n.size()>0;if(t){n.on("submit",s)}r.click(function(){if(t){s()}else if(typeof a.onaction!=="undefined"){r.button("loading");try{a.onaction(a.id)}catch(i){}}else{e("#"+a.id).modal("hide")}});i.modal("show")}function s(){n=e("form",i);if(!Validator.validateForm(n[0])){return false}r.button("loading");n.ajaxSubmit({success:function(t){r.button("complete").addClass("btn-success disabled");setTimeout(function(){if(typeof a.onsubmitted!=="undefined"){a.onsubmitted(a.id,t)}e("#"+a.id).modal("hide")},200)},error:function(e){r.button("reset");if(typeof a.onerror!=="undefined"){a.onerror(a.id,e.status)}}});return false}return{create:o}}(jQuery);var PageEditor=function(e){"use strict";var t="";var i=[];function a(a,n){t=a;i=n;var r="";e(".page-content-parts").sortable({handle:".editable .sortable-handle",itemSelector:".editable",vertical:true,nested:true,placeholder:"<i class='fa fa-chain text-danger'></i>",containerSelector:".page-content-parts, .view-subviews",onDragStart:function(e,t,i){r=c(e[0])},onDrag:function(e,t,i){e.css(t);i(e,t)},onDrop:function(e,t,i){i(e,t);var a=c(e[0]);if(a!==r){window.alert("moved")}}})}function n(){e(".btn-edit-page").toggleClass("hidden");e(".view-admin").toggleClass("hidden").parent().toggleClass("editable");var t=window.location.toString().replace(/#+editing/,"");if(e(".btn-edit-page").is(":visible")){t+="#editing"}history.pushState({},document.title,t)}function r(){s("post",t)}function o(){s("post","")}function d(){s("put")}function s(i,a){var n=i==="post"?"add_page":"edit_page";Modal.create({title:Locale.str("system",n),oncreated:function(n,r){var o="__api__/pages/";o+=i==="put"?t:"new";e("#"+n).modal("show");e.getJSON(o,function(t){var o=e("#template-pageview-addedit-page").html();t=e.extend({},t,Locale.getViewsStrings(["system"]));if(typeof a!=="undefined"){t.parentid=a}t.method=i;t.urid=UIDGenerator.get();t.simple_rights_visible=(t.rights.rights&4)>0;var d={"rights-controls":e("#template-rights-controls").html()};var s=Mustache.render(o,t,d);e(".modal-body","#"+n).html(s);r()});return true},onsubmitted:function(e,t){var i="";if(typeof t.breadcrumbs!=="undefined"){for(var a=0;a<t.breadcrumbs.length;a++){i+=encodeURI(t.breadcrumbs[a].title)+"/"}}i+=encodeURI(t.title)+"#editing";document.location=i.replace(/%20/g,"+")}})}function l(){Modal.create({title:Locale.str("system","delete_page"),btn_action:Locale.str("system","delete"),btn_class:"btn-danger",oncreated:function(i){var a=e("#template-pageview-delete-page").html();var n=Locale.getViewsStrings(["system"]);n.pageid=t;n.urid=UIDGenerator.get();var r=Mustache.render(a,n);e(".modal-body","#"+i).html(r);e("#"+i).modal("show")},onsubmitted:function(e,t){var i=document.location.toString();document.location=i.slice(0,i.lastIndexOf("/"))}})}function c(t){var i="";e(t).parents(".view").each(function(t,a){i=e(a).index().toString()+","+i});return i+e(t).index()}function u(a){var n="";var r={};var o="";Modal.create({title:Locale.str("system","edit_view"),modal_large:true,oncreated:function(d,s){o=c(a);var l="__api__/pages/"+t+"/view/"+o;e("#"+d).modal("show");e.getJSON(l,function(a){n=a.view;r=e.extend({},a.settings);var o=e("#template-pageview-edit-view").html();a=e.extend({},a,Locale.getViewsStrings(["system"]));a.urid=UIDGenerator.get();a.pageid=t;a.views=i;a.available_col_spans=[];for(var l=1;l<=12;l++){a.available_col_spans.push(l)}a.available_col_offsets=[];for(l=0;l<=12;l++){a.available_col_offsets.push(l)}var c=Mustache.render(o,a);e(".modal-body","#"+d).html(c);f("#"+d,a);s()});return true},onsubmitted:function(t,i){if(n!==i.view||JSON.stringify(r)!==JSON.stringify(i.settings)){location.reload()}else{var o="page-content-row view editable col-sm-"+i.col_span+" ";if(i.col_offset>0){o+="col-sm-offset-"+i.col_offset+" "}if(i.row_offset>0){o+="row-offset"+i.row_offset+" "}o+=i.classes;e(a).attr("class",o);if(e(a).children(".view-text").size()===0){e(a).children(".view-admin").after("<div class='view-text'></div>")}e(a).children(".view-text").html(i.content.html)}}})}function f(i,a){e("select[name=view]",i).change(function(){var n=e(this).val();if(n===""){e(".view-settings",i).html("");e(".view_texteditor textarea",i).removeClass("small");return}e(".view_texteditor textarea",i).addClass("small");e(".view-settings",i).html("<div class='loading'></div>");Locale.ensureLoaded(n,{loaded:function(){var r="views/"+n+"/coworkers/view_edit_settings.mustache?static_only=true";e.get(r,{cache:false},function(r){var o=Locale.getViewsStrings(["system",n]);a.urid=UIDGenerator.get();a.pageid=t;if(typeof a.settings==="undefined"){a.settings={}}a.settings.modalId=i.replace(/^#/,"");for(var d in o){if(o.hasOwnProperty(d)){a.settings[d]=o[d]}}var s=Mustache.to_html(r,a.settings);e(".view-settings",i).html(s)}).error(function(){e(".view-settings",i).html("")})}})}).val(a.view).trigger("change");e("select[name=col_span]",i).val(a.col_span);e("select[name=col_offset]",i).val(a.col_offset);e("select[name=row_offset]",i).val(a.row_offset);e("select[name=view] option",i).removeAttr("disabled");if(a.col_span<12){var n=[];for(var r=12;r>a.col_span;r--){n.push(".min-col-span"+r)}e(n.join(",")).attr("disabled","disabled")}TextEditor.init("#content_"+a.urid,i)}function v(i){Modal.create({title:Locale.str("system","delete_view"),btn_action:Locale.str("system","delete"),btn_class:"btn-danger",oncreated:function(a){var n=e("#template-pageview-delete-view").html();var r=Locale.getViewsStrings(["system"]);r.pageid=t;r.viewid=c(i);r.urid=UIDGenerator.get();var o=Mustache.render(n,r);e(".modal-body","#"+a).html(o)},onsubmitted:function(t,a){e(i).remove()}})}function m(e){if(typeof e.children!=="undefined"){e.has_children=e.children.length>0;for(var t in e.children){m(e.children[t])}}else{e.children=false}e.is_base=false}function p(){Modal.create({title:Locale.str("system","sitemap_view"),btn_action:Locale.str("system","close"),btn_cancel:false,modal_large:true,save_form:false,oncreated:function(i,a){var n="__api__/pages/?use_locale=false";e("#"+i).modal("show");e.getJSON(n,function(n){var r=e("#template-sitemap-view").html();var o=Locale.getViewsStrings(["system"]);o.children=n;o.pageid=t;o.urid=UIDGenerator.get();m(o);o.is_base=true;var d=Mustache.render(r,o,{sitemap:r});e(".modal-body","#"+i).html(d);SitemapView.register("sitemap-"+o.urid).initialize("sitemap-"+o.urid,t);a()});return true},onaction:function(i){var a="__api__/pages?user_locale=false&path_pageid="+t;e.getJSON(a,function(e){var t="";for(var i in e){t+=encodeURIComponent(e[i].title)+"/"}document.location=t.slice(0,-1).replace(/%20/g,"+")+"#editing"});e("#"+i).modal("hide")}})}function h(i,a){var n="__api__/pages/"+t+"/views/?_method=post&template="+i;if(a!==undefined&&a!==""){n+="&parentid="+a}e.getJSON(n,function(e){location.reload()})}return{init:a,togglePageAdmins:n,showAddSubpage:r,showAddMainpage:o,showEditPage:d,showDeletePage:l,showEditView:u,showDeleteView:v,addSubview:h,showSitemap:p}}(jQuery);var TagListInput=function(e){"use strict";function t(t){t=typeof t==="undefined"||t===""?".tag-list-wrapper":"#"+t;var a=e(t);a.each(function(){var t=e(this);if(t.children(".tag-list-ui").size()>0)return;var a=t.children("input");var n=a.hide().val().split(",");t.append("<div class='tag-list-ui'><input type='text' style='display: inline; border: 0' /></div>");var r=t.children(".tag-list-ui");var o=r.children("input");for(var d in n){i(a,o,n[d])}o.keypress(function(e){if(e.keyCode===13||e.keyCode===44||!o.is(":focus")){var t=o.val();o.val("");i(a,o,t);a.val(a.val()+", "+t);return false}});o.keydown(function(e){var t=o.val();if(e.keyCode===8&&t===""){var i=o.siblings().last();if(i.hasClass("selected")){i.children("div").click()}else{i.addClass("selected")}}else{o.siblings(".selected").removeClass("selected")}});o.focus(function(e){t.addClass("selected")});o.blur(function(e){o.trigger("keypress");t.removeClass("selected");r.children(".selected").removeClass("selected")});t.click(function(e){o.focus()})})}function i(t,i,n){n=n.trim();if(n==="")return;var r=e("<span></span>");r.addClass("tag-list-item").text(n).attr("data-tag",n);var o=e("<div style='cursor: pointer; padding-left: 3px;' aria-hidden='true'>&times;</div>");o.addClass("delete-btn");o.click(function(e){r.remove();a(t,i)});r.append(o);i.before(r)}function a(t,i){var a="";i.siblings().each(function(t){if(a!=="")a+=", ";a+=e(this).attr("data-tag")});t.val(a)}return{init:t}}(jQuery);var TextEditor=function(e){"use strict";var t="";function i(e,t){r(e,t.replace(/^#/,""))}var a={bold:{icon:"fa-bold",method:function(e,t){return c("b",e,t)}},italic:{icon:"fa-italic",method:function(e,t){return c("i",e,t)}},"divider 1":"divider",ol:{icon:"fa-list-ol",method:function(e,t){return c("list",e,t,{addNewlines:true})}},ul:{icon:"fa-list-ul",method:function(e,t){return c("bullets",e,t,{addNewlines:true})}},"divider 2":"divider",email:{icon:"fa-envelope",method:function(e,t){return u(e,t)}},url:{icon:"fa-link",method:function(e,t){return f(e,t)}},video:{icon:"fa-film",method:function(e,t){return v(e,t)}},"divider 3":"divider",img:{icon:"fa-picture-o",method:function(e,t){return m(e,t)}},file:{icon:"fa-file",method:function(e,t){return p(e,t)}}};var n=a;function r(t,i){var a="<div class='texteditor_toolbar' data-selector='"+t+"' "+"data-parent-modal='"+i+"' style='padding-bottom: 10px;'>";a+="<div class='btn-group'>";e.each(n,function(e,t){if(t==="divider"){a+="</div><div class='btn-group'>"}else{var i="<span class='fa "+t.icon+"'></span>";a+="<div class='btn btn-default' data-action='"+e+"'>"+i+"</div>"}});a+="</div></div>";e(a).insertBefore(t).find(".btn").on("click",function(){var i=e(this).attr("data-action");TextEditor.executeAction(t,i)});e(t).css("width","100%")}function o(i,a){t=e(".texteditor_toolbar",e(i).parent()).attr("data-parent-modal");n[a].method(d(i),function(e){s(i,e)})}function d(t){return e(t).textrange("get","text")}function s(t,i){e(t).textrange("replace",i)}function l(i,a,n,r){Modal.create({title:i,fade:false,oncreated:function(i){var r=e("#"+a).html();n=e.extend({},n,Locale.getViewsStrings(["system"]));n.urid=UIDGenerator.get();var o=Mustache.render(r,n);e(".modal-body","#"+i).html(o);e("#"+t).removeClass("fade").one("hidden.bs.modal",function(){e("#"+i).one("hidden.bs.modal",function(){e("#"+t).modal("show")}).modal("show")}).one("shown.bs.modal",function(){e("#"+t+", .modal-backdrop").addClass("fade")}).modal("hide")},onaction:function(t){var i={};e.each(e("form","#"+t).serializeArray(),function(e,t){i[t.name]=t.value});r(i);e("#"+t).modal("hide")}})}function c(e,t,i,a){if(a===undefined){a={}}if(a.addNewlines){t="\n"+t}t="["+e+"]"+t+"[/"+e+"]";if(a.addNewlines){t+="\n"}i(t)}function u(e,t){var i={};var a=Validator.isEmail({value:e});i.email=a?e:"";i.visible_text=a?"":e;l(Locale.str("system","texteditor_modal_email"),"template-texteditor-email",i,function(e){var i=e.visible_text===""?"[email]"+e.email+"[/email]":"[email="+e.email+"]"+e.visible_text+"[/email]";t(i)})}function f(e,t){var i={};var a=Validator.isUrl({value:e});i.url=a?e:"";i.visible_text=a?"":e;l(Locale.str("system","texteditor_modal_url"),"template-texteditor-url",i,function(e){var i=e.visible_text===""?"[url]"+e.url+"[/url]":"[url="+e.url+"]"+e.visible_text+"[/url]";t(i)})}function v(e,t){var i={};i.url=Validator.isUrl({value:e})?e:"";l(Locale.str("system","texteditor_modal_video"),"template-texteditor-video",i,function(e){t("[video]"+e.video+"[/video]")})}function m(i,a){Locale.ensureLoaded("files",{loaded:function(){var i="views/files/coworkers/select_file.mustache?static_only=true";e.get(i,{cache:true},function(i){var n=Mustache.to_html(i,Locale.getViewsStrings(["system","files"]));e("body").append("<div id='texteditor_selectfile'></div>");e("#texteditor_selectfile").html(n);SelectFile.show({multi:false,parentModalId:t,confirmed:function(e){a("[img]"+e.join()+"[/img]")},hidden:function(){e("#texteditor_selectfile").remove()}})})}})}function p(i,a){Locale.ensureLoaded("files",{loaded:function(){var i="views/files/coworkers/select_file.mustache?static_only=true";e.get(i,{cache:true},function(i){var n=Mustache.to_html(i,Locale.getViewsStrings(["system","files"]));e("body").append("<div id='texteditor_selectfile'></div>");e("#texteditor_selectfile").html(n);SelectFile.show({multi:false,parentModalId:t,confirmed:function(e){var t=e.join();var i=SelectFile.getCachedFilename(t);a("[url=__api__/files/"+t+"/download]"+i+"[/url]")},hidden:function(){e("#texteditor_selectfile").remove()}})})}})}return{init:i,executeAction:o}}(jQuery);var UIDGenerator=function(){"use strict";function e(){var e=setTimeout(function(){clearTimeout(e)},0);return e}return{get:e}}();var Validator=function(e){"use strict";var t={};function i(i){t={};try{e("[data-validation]:visible",i).each(function(){a(this)})}catch(n){return false}return Object.keys(t).length===0}function a(i){var a=e(i).attr("data-validation").split(" ");var r=true;e.each(a,function(a,o){var d={};e(i).parent().removeClass("has-error");if(!n(o,i,d)){t[i.name]=typeof t[i.name]!=="undefined"?t[i.name]:[];t[i.name].push(o);e(i).parent().addClass("has-error");r=false}});return r}function n(e,t,i){switch(e){case"required":return r(t,i);case"numeric":return o(t,i);case"email":return d(t,i);case"url":return s(t,i);case"date":return l(t,i);case"time":return c(t,i);case"datetime":return u(t,i);default:return true}}function r(e,t){return e.nodeName==="INPUT"&&e.type==="checkbox"?e.checked:e.value.replace(/\s+$/,"")!==""}function o(e,t){var i=e.value;if(t.decimalChar!=="."){i=i.replace(t.decimalChar,".")}return!isNaN(i)}function d(e,t){var i=/^([a-zA-Z0-9_\.\-])+@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;return i.test(e.value)}function s(e,t){var i=/^[-a-zA-Z0-9@:%_\+.~#?&//=]{2,256}\.[a-z]{2,4}\b(\/[-a-zA-Z0-9@:%_\+.~#?&//=]*)?$/gi;return i.test(e.value)}function l(e,t){var i=/^\d{4}-(((0?1|0?3|0?5|0?7|0?8|10|12)-(0?[1-9]|[12]?\d|3[01]))|((0?4|0?6|0?9|11)-(0?[1-9]|[12]?\d|30))|((0?2)-(0?[1-9]|[12]\d)))$/gi;return i.test(e.value)}function c(e,t){var i=/^([01]?[0-9]|2[0-3]):[0-5][0-9](:([0-5][0-9]))?$/gi;return i.test(e.value)}function u(e,t){var i=/^([\+-]?\d{4}(?!\d{2}\b))((-?)((0[1-9]|1[0-2])(\3([12]\d|0[1-9]|3[01]))?|W([0-4]\d|5[0-2])(-?[1-7])?|(00[1-9]|0[1-9]\d|[12]\d{2}|3([0-5]\d|6[1-6])))([T\s]((([01]\d|2[0-3])((:?)[0-5]\d)?|24\:?00)([\.,]\d+(?!:))?)?(\17[0-5]\d([\.,]\d+)?)?([zZ]|([\+-])([01]\d|2[0-3]):?([0-5]\d)?)?)?)?$/gi;return i.test(e.value)}return{validateForm:i,isRequired:r,isNumberic:o,isEmail:d,isUrl:s,isDate:l,isTime:c,isDateTime:u}}(jQuery);