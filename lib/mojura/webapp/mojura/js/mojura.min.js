var AdvancedObjectRights=function(e){"use strict";var t;function i(i,a,o,s){var l=s.parentModalId;Modal.create({title:Locale.str("system","advanced_object_rights"),oncreated:function(r,d){t=r;n(i,a,o);if(typeof l!=="undefined"){e("#"+l).removeClass("fade").one("hidden.bs.modal",function(){e("#"+t).removeClass("fade").one("hidden.bs.modal",function(){e("#"+l).one("shown.bs.modal",function(){e(this).addClass("fade")}).modal("show")}).modal("show")}).modal("hide")}else{d()}},onaction:function(){if(typeof s.onsave!=="undefined"){s.onsave(r(),d("users"),d("groups"))}e("#"+t).modal("hide")}})}function n(i,n,r){var d=e("#template-advanced-object-rights").html();var s=Locale.getViewStrings("system");s.categories=[{name:Locale.str("system","guests"),bits:[4,3,2,1]},{name:Locale.str("system","users"),bits:[8,7,6,5]},{name:Locale.str("system","groupmembers"),bits:[12,11,10,9]},{name:Locale.str("system","owners"),bits:[16,15,14,13]}];var l=Mustache.render(d,s);e(".modal-body","#"+t).html(l);a(i);o("users",n);o("groups",r);var c=function(t){e(t).closest(".input-group").find(".btn-success").toggleClass("disabled",e(t).attr("data-id")==="")};AutoComplete.prepare("#"+t+" .add-users input",{category:"users",onselected:c});AutoComplete.prepare("#"+t+" .add-groups input",{category:"groups",onselected:c})}function a(i){e(".advanced-rights-checkbox","#"+t).each(function(){var t=parseInt(e(this).attr("data-bit"),10);var n=1<<t-1;var a=i&n;e(this).prop("checked",i&n)})}function r(){var i=0;e(".advanced-rights-checkbox:checked","#"+t).each(function(){var t=parseInt(e(this).attr("data-bit"),10);i+=1<<t-1});return i}function o(i,n){if(n.length>0){e(".advanced-rights-"+i+"-list","#"+t).html("<div class='loading'></div>");var a="__api__/"+i+"?filter=id:("+n.join(encodeURIComponent("|"))+")";e.getJSON(a,function(n){var a=e("#template-advanced-object-rights-"+i).html();var r={};r[i]=n.items;var o=Mustache.render(a,r);e(".advanced-rights-"+i+"-list","#"+t).html(o);e(".advanced-rights-"+i+"-alert","#"+t).toggleClass("hidden",n.items.length!==0)})}else{e(".advanced-rights-"+i+"-alert","#"+t).removeClass("hidden")}}function d(i){var n=[];e(".advanced-rights-"+i+"-list .listitem","#"+t).each(function(){n.push(e(this).attr("data-id"))});return n}function s(i,n){e(i).parent().parent().remove();var a=e(".advanced-rights-"+n+"-list .listitem","#"+t).size()>0;e(".advanced-rights-"+n+"-alert","#"+t).toggleClass("hidden",a)}function l(i){e("#"+t+" .add-"+i).removeClass("hidden").find(".btn-success").addClass("disabled")}function c(i){var n=e(".add-"+i+" input","#"+t);var a=n.attr("data-id");var r=n.val();var o={};if(i==="users"){o={users:{id:a,fullname:r}}}else{o={groups:{id:a,name:r}}}var d=e("#template-advanced-object-rights-"+i).html();var s=Mustache.render(d,o);e(".advanced-rights-"+i+"-list","#"+t).append(s);e(".advanced-rights-"+i+"-alert").addClass("hidden");e("#"+t+" .add-"+i).addClass("hidden")}function u(i){e("#"+t+" .add-"+i).addClass("hidden")}return{show:i,removeId:s,showAdd:l,confirmAdd:c,cancelAdd:u}}(jQuery);var Alert=function(){"use strict";var e;function t(t){t.type=typeof t.type!=="undefined"?t.type:"danger";t.dismissable=typeof t.dismissable!=="undefined"?t.dismissable:true;if(typeof t.title==="undefined"){t.title=Locale.str("system","alert_title_"+t.type)}if(typeof e==="undefined"){e=$("#template-alert").html()}return Mustache.render(e,t)}return{create:t}}();var AutoComplete=function(e){"use strict";var t={};function i(i,r){var o=r.dataset||r.category||UIDGenerator.get();t[o]={input:i,options:n(r)};var d=e(i);e(i).after("<ul class='autocomplete-dropdown dropdown-menu hidden' data-toggle='dropdown'></ul>");t[o].$input=d;t[o].options=n(r);t[o].$dropdown=d.next(".autocomplete-dropdown");r=t[o].options;var s=t[o].$dropdown;var l="";d.blur(function(){clearTimeout(r.timer);var i=t[o].$dropdown.children("li");if(i.size()===1&&i.first().text()===e(this).val()){i.first().click();return}setTimeout(function(){if(typeof d.attr("data-id")==="undefined"||d.attr("data-id")===""){d.val("")}s.addClass("hidden")},500)}).keyup(function(e){if(e.keyCode===27){s.addClass("hidden")}else if(e.keyCode===38){s.children("li.active").prev("li").addClass("active").next("li").removeClass("active")}else if(e.keyCode===40){var t=s.children("li.active");if(t.size()===0){s.children("li").first().addClass("active")}else{t.next().addClass("active").prev().removeClass("active")}}else if(e.keyCode===13){s.children("li.active").click()}}).keypress(function(){if(r.timer===null||typeof r.timer==="undefined"){clearTimeout(r.timer)}r.timer=setTimeout(function(){a(o,d.val())},r.delay)})}function n(e){e=e||{};e.url=e.url||"__api__/search?keywords=%KEYWORDS%&pagesize=%LENGTH%&category=%CATEGORY%";e.item_template=e.item_template||"<li data-id='{{id}}'>{{title}}</li>";e.timer=null;e.length=e.length||8;e.category=e.category||"";e.forceSelection=true;e.delay=1e3;return e}function a(i,n){var a=t[i].$dropdown;var r=t[i].$input;var o=t[i].options;if(n===""){a.addClass("hidden");return}var d=o.url.replace(/%KEYWORDS%/,n).replace(/%LENGTH%/,o.length).replace(/%CATEGORY%/,o.category);e.getJSON(d,function(t){var i="";var n="";for(var d in t){n+=Mustache.render(o.item_template,t[d])}a.toggleClass("hidden",n==="");a.html(n).children("li").click(function(){clearTimeout(o.timer);r.attr("data-id",e(this).attr("data-id")).val(e(this).text());a.addClass("hidden");if(typeof o.onselected!=="undefined"){o.onselected(r[0])}})})}return{prepare:i}}(jQuery);var KeyValueParser=function(){"use strict";var e;function t(t,i){i=typeof i!=="undefined"?i:{};i.sep_char=typeof i.sep_char!=="undefined"?i.sep_char:"=";i.trim_values=typeof i.trim_values!=="undefined"?i.trim_values:true;i.comment_char=typeof i.comment_char!=="undefined"?i.comment_char:"#";var n={};var a=t.match(/[^\r\n]+/g);for(var r in a){if(a.hasOwnProperty(r)){var o=a[r].replace(/^\s+|\s+$/g);if(o!==""&&o[0]!==i.comment_char){var d=o.split(i.sep_char,2);var s=d[0].toString().replace(/^\s+|\s+$/g,"");var l=d[1];if(i.trim_values){l=l.replace(/^\s+|\s+$/g,"")}n[s]=l}}}e=n;return n}function i(){var t="";if(typeof e!=="undefined"){for(var i in e){if(e.hasOwnProperty(i)){t+=i+": "+e[i]+"\n"}}}return t}return{parse:t,toString:i}}();var LightBox=function(e){"use strict";var t={};var i={};var n;var a;var r;var o;var d;function s(e,n,a){t[e]=t[e]||[];i[e]=i[e]||0;a=a||{};a.url=n;a.type="image";a.name="";a.description="";t[e].push(a)}function l(s,l){if(typeof t[s]==="undefined"){return}n=s;d=d||e("#template-lightbox").html();if(typeof l==="number"){i[n]=l}else{i[n]=h(l)}var f=Mustache.to_html(d,{group:n});e("body").append(f);a=e("#lightbox-"+n);o=e(".lightbox-content",a);r=e(".lightbox-dialog",a);var p=function(e){if(e.keyCode===27){a.modal("hide")}else if(e.keyCode===37){v()}else if(e.keyCode===39){m()}};a.on("shown.bs.modal",function(){e(window).on("resize",c);e(document).on("keyup",p)});a.on("hide.bs.modal",function(){e(window).off("resize",c);e(document).off("keyup",p)});a.on("hidden.bs.modal",function(){a.remove()});e(".lightbox-left, .lightbox-right",a).toggleClass("hidden",t[n].length<2);u();a.modal("show")}function c(){o.height("auto");if(e(window).height()<=r.height()){o.height(e(window).height())}}function u(){var r=i[n]||0;var o=t[n][r];e(".lightbox-content > *",a).addClass("hidden");if(o.type==="image"){e(".lightbox-image",a).load(c).attr("src",o.url).removeClass("hidden")}}function f(e){var a=t[n].length;i[n]=(i[n]+a+e)%a;u(n)}function v(){f(-1)}function m(){f(1)}function h(e){for(var i in t[n]){if(typeof t[n][i]!=="undefined"){var a=t[n][i];if(a.url===e){return Number(i)}}}return 0}function p(e){t[e]=[];i[e]=0}return{add:s,show:l,previous:v,next:m,clear:p}}(jQuery);var Locale=function(e){"use strict";var t="";var i={};function n(e){t=e}function a(e,t){if(typeof i[e]==="undefined"){r(e,t)}else if(typeof t!=="undefined"&&typeof t.loaded!=="undefined"){t.loaded()}}function r(n,a){if(t===""){window.alert('You should initialize the locale object with Locale.init("en"), where "en" is the used locale.');return}if(typeof n==="undefined"){throw"The view needs to be set calling Locale.load(view, [options = {}])"}var r=n==="system"?"mojura/views/strings."+t+".kv":"views/"+n+"/strings."+t+".kv";e.ajax({url:r,error:function(){if(typeof a!=="undefined"&&typeof a.loaded!=="undefined"&&a.breakOnFail!==true){a.loaded()}},fail:function(){window.console.log("Error fetching "+r);if(typeof a.error!=="undefined"){a.error()}if(typeof a!=="undefined"&&typeof a.loaded!=="undefined"&&a.breakOnFail!==true){a.loaded()}},success:function(e){try{i[n]=KeyValueParser.parse(e);if(typeof a!=="undefined"&&typeof a.loaded!=="undefined"){a.loaded()}}catch(t){window.console.log("Error on parsing "+r+": "+t.message);i[n]={};if(typeof a.error!=="undefined"){a.error()}}}})}function o(e,t,n){if(typeof i[e]==="undefined"){i[e]={}}i[e][t]=n}function d(e,t){if(typeof i[e]!=="undefined"&&typeof i[e][t]!=="undefined"){return i[e][t]}else{return"__"+e+"_"+t+"__"}}function s(){var t=[];e.each(i,function(e,i){t.push(e)});return t}function l(t,n,a){n=typeof n==="undefined"||n===true;var r=typeof a!=="undefined";var o={};if(typeof i[t]!=="undefined"){e.each(i[t],function(e,i){if(!r||e.indexOf(a)===0){if(n){o["locale_str_"+t+"_"+e]=i}else{o[e]=i}}})}return o}function c(t,i,n){i=typeof i==="undefined"||i===true;var a={};if(typeof t==="undefined"){return a}e.each(t,function(t,r){var o=l(r,i,n);if(i){a=e.extend({},a,o)}else{a[r]=o}});return a}return{init:n,ensureLoaded:a,loadedViews:s,add:o,str:d,getViewStrings:l,getViewsStrings:c}}(jQuery);var Modal=function(e){"use strict";var t=1;var i;var n;var a;var r;function o(a){n=a;Locale.ensureLoaded("system",{loaded:function(){var a=e("#template-modal").html();if(typeof n.id==="undefined"){n.id="modal_"+t++}n.btn_action=typeof n.btn_action!=="undefined"?n.btn_action:Locale.str("system","save");n.btn_class=typeof n.btn_class!=="undefined"?n.btn_class:"btn-primary";n.btn_cancel=typeof n.btn_cancel!=="undefined"?n.btn_cancel:Locale.str("system","cancel");n.modal_large=n.modal_large===true;n.fade=n.fade!==false;n.urid=UIDGenerator.get();n.save_form=n.save_form!==false;var r=Mustache.render(a,n);e("body").append(r);i=e("#"+n.id);i.on("hidden.bs.modal",function(e){if(i.hasClass("fade")){i.remove()}});if(!n.oncreated||!n.oncreated(n.id,d)){d()}}})}function d(){r=e("."+n.btn_class,i);a=e("form",i);var t=n.save_form&&a.size()>0;if(t){a.on("submit",s)}r.click(function(){if(t){s()}else if(typeof n.onaction!=="undefined"){r.button("loading");try{n.onaction(n.id)}catch(i){}}else{e("#"+n.id).modal("hide")}});i.modal("show")}function s(){a=e("form",i);if(!Validator.validateForm(a[0])){return false}r.button("loading");a.ajaxSubmit({success:function(t){r.button("complete").addClass("btn-success disabled");setTimeout(function(){if(typeof n.onsubmitted!=="undefined"){n.onsubmitted(n.id,t)}e("#"+n.id).modal("hide")},200)},error:function(e){r.button("reset");if(typeof n.onerror!=="undefined"){n.onerror(n.id,e.status)}}});return false}return{create:o}}(jQuery);var PageEditor=function(e){"use strict";var t="";var i=[];function n(n,a){t=n;i=a;var r="";e(".page-content-parts").sortable({handle:".editable .sortable-handle",itemSelector:".editable",vertical:true,nested:true,placeholder:"<i class='fa fa-chain text-danger'></i>",containerSelector:".page-content-parts, .view-subviews",onDragStart:function(e,t,i){r=c(e[0])},onDrag:function(e,t,i){e.css(t);i(e,t)},onDrop:function(e,t,i){i(e,t);var n=c(e[0]);if(n!==r){window.alert("moved")}}})}function a(){e(".btn-edit-page").toggleClass("hidden");e(".view-admin").toggleClass("hidden").parent().toggleClass("editable");var t=window.location.toString().replace(/#+editing/,"");if(e(".btn-edit-page").is(":visible")){t+="#editing"}history.pushState({},document.title,t)}function r(){s("post",t)}function o(){s("post","")}function d(){s("put")}function s(i,n){var a=i==="post"?"add_page":"edit_page";Modal.create({title:Locale.str("system",a),oncreated:function(a,r){var o="__api__/pages/";o+=i==="put"?t:"new";e("#"+a).modal("show");e.getJSON(o,function(t){var o=e("#template-pageview-addedit-page").html();t=e.extend({},t,Locale.getViewsStrings(["system"]));if(typeof n!=="undefined"){t.parentid=n}t.method=i;t.urid=UIDGenerator.get();t.simple_rights_visible=(t.rights.rights&4)>0;var d={"rights-controls":e("#template-rights-controls").html()};var s=Mustache.render(o,t,d);e(".modal-body","#"+a).html(s);r()});return true},onsubmitted:function(e,t){var i="";if(typeof t.breadcrumbs!=="undefined"){for(var n=0;n<t.breadcrumbs.length;n++){i+=encodeURI(t.breadcrumbs[n].title)+"/"}}i+=encodeURI(t.title)+"#editing";document.location=i.replace(/%20/g,"+")}})}function l(){Modal.create({title:Locale.str("system","delete_page"),btn_action:Locale.str("system","delete"),btn_class:"btn-danger",oncreated:function(i){var n=e("#template-pageview-delete-page").html();var a=Locale.getViewsStrings(["system"]);a.pageid=t;a.urid=UIDGenerator.get();var r=Mustache.render(n,a);e(".modal-body","#"+i).html(r);e("#"+i).modal("show")},onsubmitted:function(e,t){var i=document.location.toString();document.location=i.slice(0,i.lastIndexOf("/"))}})}function c(t){var i="";e(t).parents(".view").each(function(t,n){i=e(n).index().toString()+","+i});return i+e(t).index()}function u(n){var a="";var r={};var o="";Modal.create({title:Locale.str("system","edit_view"),modal_large:true,oncreated:function(d,s){o=c(n);var l="__api__/pages/"+t+"/view/"+o;e("#"+d).modal("show");e.getJSON(l,function(n){a=n.view;r=e.extend({},n.settings);var o=e("#template-pageview-edit-view").html();n=e.extend({},n,Locale.getViewsStrings(["system"]));n.urid=UIDGenerator.get();n.pageid=t;n.views=i;n.available_col_spans=[];for(var l=1;l<=12;l++){n.available_col_spans.push(l)}n.available_col_offsets=[];for(l=0;l<=12;l++){n.available_col_offsets.push(l)}var c=Mustache.render(o,n);e(".modal-body","#"+d).html(c);f("#"+d,n);s()});return true},onsubmitted:function(t,i){if(a!==i.view||JSON.stringify(r)!==JSON.stringify(i.settings)){location.reload()}else{e(n).children(".view-text").html(i.content.html)}}})}function f(i,n){e("select[name=view]",i).change(function(){var a=e(this).val();if(a===""){e(".view-settings",i).html("");e(".view_texteditor textarea",i).removeClass("small");return}e(".view_texteditor textarea",i).addClass("small");e(".view-settings",i).html("<div class='loading'></div>");Locale.ensureLoaded(a,{loaded:function(){var r="views/"+a+"/coworkers/view_edit_settings.mustache?static_only=true";e.get(r,{cache:false},function(r){var o=Locale.getViewsStrings(["system",a]);n.urid=UIDGenerator.get();n.pageid=t;if(typeof n.settings==="undefined"){n.settings={}}n.settings.modalId=i.replace(/^#/,"");for(var d in o){if(o.hasOwnProperty(d)){n.settings[d]=o[d]}}var s=Mustache.to_html(r,n.settings);e(".view-settings",i).html(s)}).error(function(){e(".view-settings",i).html("")})}})}).val(n.view).trigger("change");e("select[name=col_span]",i).val(n.col_span);e("select[name=col_offset]",i).val(n.col_offset);e("select[name=row_offset]",i).val(n.row_offset);e("select[name=view] option",i).removeAttr("disabled");if(n.col_span<12){var a=[];for(var r=12;r>n.col_span;r--){a.push(".min-col-span"+r)}e(a.join(",")).attr("disabled","disabled")}TextEditor.init("#content_"+n.urid,i)}function v(i){Modal.create({title:Locale.str("system","delete_view"),btn_action:Locale.str("system","delete"),btn_class:"btn-danger",oncreated:function(n){var a=e("#template-pageview-delete-view").html();var r=Locale.getViewsStrings(["system"]);r.pageid=t;r.viewid=c(i);r.urid=UIDGenerator.get();var o=Mustache.render(a,r);e(".modal-body","#"+n).html(o)},onsubmitted:function(t,n){e(i).remove()}})}function m(e){if(typeof e.children!=="undefined"){e.has_children=e.children.length>0;for(var t in e.children){m(e.children[t])}}else{e.children=false}e.is_base=false}function h(){Modal.create({title:Locale.str("system","sitemap_view"),btn_action:Locale.str("system","close"),btn_cancel:false,modal_large:true,save_form:false,oncreated:function(i,n){var a="__api__/pages/?use_locale=false";e("#"+i).modal("show");e.getJSON(a,function(a){var r=e("#template-sitemap-view").html();var o=Locale.getViewsStrings(["system"]);o.children=a;o.pageid=t;o.urid=UIDGenerator.get();m(o);o.is_base=true;var d=Mustache.render(r,o,{sitemap:r});e(".modal-body","#"+i).html(d);SitemapView.register("sitemap-"+o.urid).initialize("sitemap-"+o.urid,t);n()});return true},onaction:function(i){var n="__api__/pages?user_locale=false&path_pageid="+t;e.getJSON(n,function(e){var t="";for(var i in e){t+=encodeURIComponent(e[i].title)+"/"}document.location=t.slice(0,-1).replace(/%20/g,"+")+"#editing"});e("#"+i).modal("hide")}})}function p(i,n){var a="__api__/pages/"+t+"/views/?_method=post&template="+i;if(n!==undefined&&n!==""){a+="&parentid="+n}e.getJSON(a,function(e){location.reload()})}return{init:n,togglePageAdmins:a,showAddSubpage:r,showAddMainpage:o,showEditPage:d,showDeletePage:l,showEditView:u,showDeleteView:v,addSubview:p,showSitemap:h}}(jQuery);var TagListInput=function(e){"use strict";function t(t){t=typeof t==="undefined"||t===""?".tag-list-wrapper":"#"+t;var n=e(t);n.each(function(){var t=e(this);if(t.children(".tag-list-ui").size()>0)return;var n=t.children("input");var a=n.hide().val().split(",");t.append("<div class='tag-list-ui'><input type='text' style='display: inline; border: 0' /></div>");var r=t.children(".tag-list-ui");var o=r.children("input");for(var d in a){i(n,o,a[d])}o.keypress(function(e){if(e.keyCode===13||e.keyCode===44||!o.is(":focus")){var t=o.val();o.val("");i(n,o,t);n.val(n.val()+", "+t);return false}});o.keydown(function(e){var t=o.val();if(e.keyCode===8&&t===""){var i=o.siblings().last();if(i.hasClass("selected")){i.children("div").click()}else{i.addClass("selected")}}else{o.siblings(".selected").removeClass("selected")}});o.focus(function(e){t.addClass("selected")});o.blur(function(e){o.trigger("keypress");t.removeClass("selected");r.children(".selected").removeClass("selected")});t.click(function(e){o.focus()})})}function i(t,i,a){a=a.trim();if(a==="")return;var r=e("<span></span>");r.addClass("tag-list-item").text(a).attr("data-tag",a);var o=e("<div style='cursor: pointer; padding-left: 3px;' aria-hidden='true'>&times;</div>");o.addClass("delete-btn");o.click(function(e){r.remove();n(t,i)});r.append(o);i.before(r)}function n(t,i){var n="";i.siblings().each(function(t){if(n!=="")n+=", ";n+=e(this).attr("data-tag")});t.val(n)}return{init:t}}(jQuery);var TextEditor=function(e){"use strict";var t="";function i(e,t){r(e,t.replace(/^#/,""))}var n={bold:{icon:"fa-bold",method:function(e,t){return c("b",e,t)}},italic:{icon:"fa-italic",method:function(e,t){return c("i",e,t)}},"divider 1":"divider",ol:{icon:"fa-list-ol",method:function(e,t){return c("list",e,t,{addNewlines:true})}},ul:{icon:"fa-list-ul",method:function(e,t){return c("bullets",e,t,{addNewlines:true})}},"divider 2":"divider",email:{icon:"fa-envelope",method:function(e,t){return u(e,t)}},url:{icon:"fa-link",method:function(e,t){return f(e,t)}},video:{icon:"fa-film",method:function(e,t){return v(e,t)}},"divider 3":"divider",img:{icon:"fa-picture-o",method:function(e,t){return m(e,t)}},file:{icon:"fa-file",method:function(e,t){return h(e,t)}}};var a=n;function r(t,i){var n="<div class='texteditor_toolbar' data-selector='"+t+"' "+"data-parent-modal='"+i+"' style='padding-bottom: 10px;'>";n+="<div class='btn-group'>";e.each(a,function(e,t){if(t==="divider"){n+="</div><div class='btn-group'>"}else{var i="<span class='fa "+t.icon+"'></span>";n+="<div class='btn btn-default' data-action='"+e+"'>"+i+"</div>"}});n+="</div></div>";e(n).insertBefore(t).find(".btn").on("click",function(){var i=e(this).attr("data-action");TextEditor.executeAction(t,i)});e(t).css("width","100%")}function o(i,n){t=e(".texteditor_toolbar",e(i).parent()).attr("data-parent-modal");a[n].method(d(i),function(e){s(i,e)})}function d(t){return e(t).textrange("get","text")}function s(t,i){e(t).textrange("replace",i)}function l(i,n,a,r){Modal.create({title:i,fade:false,oncreated:function(i){var r=e("#"+n).html();a=e.extend({},a,Locale.getViewsStrings(["system"]));a.urid=UIDGenerator.get();var o=Mustache.render(r,a);e(".modal-body","#"+i).html(o);e("#"+t).removeClass("fade").one("hidden.bs.modal",function(){e("#"+i).one("hidden.bs.modal",function(){e("#"+t).modal("show")}).modal("show")}).one("shown.bs.modal",function(){e("#"+t+", .modal-backdrop").addClass("fade")}).modal("hide")},onaction:function(t){var i={};e.each(e("form","#"+t).serializeArray(),function(e,t){i[t.name]=t.value});r(i);e("#"+t).modal("hide")}})}function c(e,t,i,n){if(n===undefined){n={}}if(n.addNewlines){t="\n"+t}t="["+e+"]"+t+"[/"+e+"]";if(n.addNewlines){t+="\n"}i(t)}function u(e,t){var i={};var n=Validator.isEmail({value:e});i.email=n?e:"";i.visible_text=n?"":e;l(Locale.str("system","texteditor_modal_email"),"template-texteditor-email",i,function(e){var i=e.visible_text===""?"[email]"+e.email+"[/email]":"[email="+e.email+"]"+e.visible_text+"[/email]";t(i)})}function f(e,t){var i={};var n=Validator.isUrl({value:e});i.url=n?e:"";i.visible_text=n?"":e;l(Locale.str("system","texteditor_modal_url"),"template-texteditor-url",i,function(e){var i=e.visible_text===""?"[url]"+e.url+"[/url]":"[url="+e.url+"]"+e.visible_text+"[/url]";t(i)})}function v(e,t){var i={};i.url=Validator.isUrl({value:e})?e:"";l(Locale.str("system","texteditor_modal_video"),"template-texteditor-video",i,function(e){t("[video]"+e.video+"[/video]")})}function m(i,n){Locale.ensureLoaded("files",{loaded:function(){var i="views/files/coworkers/select_file.mustache?static_only=true";e.get(i,{cache:true},function(i){var a=Mustache.to_html(i,Locale.getViewsStrings(["system","files"]));e("body").append("<div id='texteditor_selectfile'></div>");e("#texteditor_selectfile").html(a);SelectFile.show({multi:false,parentModalId:t,confirmed:function(e){n("[img]"+e.join()+"[/img]")},hidden:function(){e("#texteditor_selectfile").remove()}})})}})}function h(i,n){Locale.ensureLoaded("files",{loaded:function(){var i="views/files/coworkers/select_file.mustache?static_only=true";e.get(i,{cache:true},function(i){var a=Mustache.to_html(i,Locale.getViewsStrings(["system","files"]));e("body").append("<div id='texteditor_selectfile'></div>");e("#texteditor_selectfile").html(a);SelectFile.show({multi:false,parentModalId:t,confirmed:function(e){var t=e.join();var i=SelectFile.getCachedFilename(t);n("[url=__api__/files/"+t+"/download]"+i+"[/url]")},hidden:function(){e("#texteditor_selectfile").remove()}})})}})}return{init:i,executeAction:o}}(jQuery);var UIDGenerator=function(){"use strict";function e(){var e=setTimeout(function(){clearTimeout(e)},0);return e}return{get:e}}();var Validator=function(e){"use strict";var t={};function i(i){t={};try{e("[data-validation]:visible",i).each(function(){n(this)})}catch(a){return false}return Object.keys(t).length===0}function n(i){var n=e(i).attr("data-validation").split(" ");var r=true;e.each(n,function(n,o){var d={};e(i).parent().removeClass("has-error");if(!a(o,i,d)){t[i.name]=typeof t[i.name]!=="undefined"?t[i.name]:[];t[i.name].push(o);e(i).parent().addClass("has-error");r=false}});return r}function a(e,t,i){switch(e){case"required":return r(t,i);case"numeric":return o(t,i);case"email":return d(t,i);case"url":return s(t,i);case"date":return l(t,i);case"time":return c(t,i);case"datetime":return u(t,i);default:return true}}function r(e,t){return e.nodeName==="INPUT"&&e.type==="checkbox"?e.checked:e.value.replace(/\s+$/,"")!==""}function o(e,t){var i=e.value;if(t.decimalChar!=="."){i=i.replace(t.decimalChar,".")}return!isNaN(i)}function d(e,t){var i=/^([a-zA-Z0-9_\.\-])+@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;return i.test(e.value)}function s(e,t){var i=/^[-a-zA-Z0-9@:%_\+.~#?&//=]{2,256}\.[a-z]{2,4}\b(\/[-a-zA-Z0-9@:%_\+.~#?&//=]*)?$/gi;return i.test(e.value)}function l(e,t){var i=/^\d{4}-(((0?1|0?3|0?5|0?7|0?8|10|12)-(0?[1-9]|[12]?\d|3[01]))|((0?4|0?6|0?9|11)-(0?[1-9]|[12]?\d|30))|((0?2)-(0?[1-9]|[12]\d)))$/gi;return i.test(e.value)}function c(e,t){var i=/^([01]?[0-9]|2[0-3]):[0-5][0-9](:([0-5][0-9]))?$/gi;return i.test(e.value)}function u(e,t){var i=/^([\+-]?\d{4}(?!\d{2}\b))((-?)((0[1-9]|1[0-2])(\3([12]\d|0[1-9]|3[01]))?|W([0-4]\d|5[0-2])(-?[1-7])?|(00[1-9]|0[1-9]\d|[12]\d{2}|3([0-5]\d|6[1-6])))([T\s]((([01]\d|2[0-3])((:?)[0-5]\d)?|24\:?00)([\.,]\d+(?!:))?)?(\17[0-5]\d([\.,]\d+)?)?([zZ]|([\+-])([01]\d|2[0-3]):?([0-5]\d)?)?)?)?$/gi;return i.test(e.value)}return{validateForm:i,isRequired:r,isNumberic:o,isEmail:d,isUrl:s,isDate:l,isTime:c,isDateTime:u}}(jQuery);